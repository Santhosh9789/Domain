<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CryptoStat | Live Dashboard</title>
  <link href="../../../assets/img/favicon.png" rel="icon" type="image/png">
  <link href="../../../assets/img/apple-touch-icon.png" rel="apple-touch-icon">
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --bg-dark: #121212; --card-bg: #1e1e1e; --text-white: #ffffff; --text-gray: #a0a0a0;
            --accent-orange: #f7931a; --accent-purple: #627eea; --accent-blue: #0d8abc;
            --success: #00d395; --danger: #ff5252;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Space Grotesk', sans-serif; background-color: var(--bg-dark); color: var(--text-white); }
        .container { display: flex; min-height: 100vh; }
        
        /* Sidebar */
        .sidebar { width: 250px; background-color: var(--card-bg); padding: 30px; display: flex; flex-direction: column; justify-content: space-between; }
        .logo { font-size: 1.5rem; font-weight: 700; margin-bottom: 50px; color: var(--accent-blue); display: flex; align-items: center; gap: 10px; }
        .menu li { list-style: none; padding: 15px; color: var(--text-gray); cursor: pointer; transition: 0.3s; display: flex; align-items: center; gap: 15px; border-radius: 10px; }
        .menu li:hover, .menu li.active { background: rgba(255,255,255,0.05); color: var(--text-white); font-weight: 600; }
        .logout { color: var(--danger); cursor: pointer; display: flex; gap: 10px; align-items: center; }

        /* Main */
        .main-content { flex: 1; padding: 30px 50px; }
        header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        .live-indicator { display: flex; align-items: center; gap: 8px; font-size: 0.9rem; color: var(--success); background: rgba(0, 211, 149, 0.1); padding: 5px 12px; border-radius: 20px; }
        .blink { width: 8px; height: 8px; background: var(--success); border-radius: 50%; animation: blinker 1.5s linear infinite; }
        @keyframes blinker { 50% { opacity: 0; } }

        .stats-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 30px; }
        .card { 
            background: var(--card-bg); padding: 20px; border-radius: 20px; position: relative; overflow: hidden;
            will-change: transform;
            backface-visibility: hidden;
            transform: translateZ(0);
        }
        .card h3 { font-size: 0.9rem; color: var(--text-gray); margin-bottom: 5px; }
        .card .price { font-size: 1.4rem; font-weight: 700; display: flex; align-items: center; gap: 10px; }
        .card .change { font-size: 0.8rem; font-weight: 600; margin-top: 5px; display: inline-block; }
        .up { color: var(--success); } .down { color: var(--danger); }

        .dashboard-grid { display: grid; grid-template-columns: 2fr 1fr; gap: 30px; }
        .chart-container, .market-list { background: var(--card-bg); padding: 25px; border-radius: 20px; }
        
        /* Market List Table */
        .market-header { display: flex; justify-content: space-between; margin-bottom: 15px; font-size: 0.9rem; color: var(--text-gray); }
        .coin-row { display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid rgba(255,255,255,0.05); transition: 0.2s; }
        .coin-row:hover { background: rgba(255,255,255,0.02); padding-left: 10px; padding-right: 10px; margin: 0 -10px; border-radius: 8px; }
        .coin-info { display: flex; align-items: center; gap: 10px; }
        .coin-info img { width: 30px; height: 30px; border-radius: 50%; }

        .btn-trade { background: var(--accent-blue); border: none; padding: 5px 15px; border-radius: 5px; color: white; cursor: pointer; font-size: 0.8rem; }
        .btn-trade:hover { opacity: 0.8; }
    </style>
</head>
<body>

    <div class="container">
        <aside class="sidebar">
            <div class="logo"><i class="fab fa-bitcoin"></i> CryptoStat</div>
            <ul class="menu">
                <li class="active" onclick="setView('dashboard')"><i class="fas fa-th-large"></i> Dashboard</li>
                <li onclick="alert('Wallet Integration coming soon!')"><i class="fas fa-wallet"></i> My Wallet</li>
                <li onclick="alert('Trade history is empty.')"><i class="fas fa-exchange-alt"></i> Transactions</li>
                <li onclick="window.open('https://coingecko.com')"><i class="fas fa-chart-line"></i> Market News</li>
            </ul>
            <div class="logout"><i class="fas fa-sign-out-alt"></i> Logout</div>
        </aside>

        <main class="main-content">
            <header>
                <div>
                    <h1>Market Overview</h1>
                    <p style="color:var(--text-gray); font-size: 0.9rem;">Welcome back, Trader</p>
                </div>
                <div class="live-indicator">
                    <div class="blink"></div> Live Market
                </div>
            </header>

            <!-- Top Cards (Live Data) -->
            <div class="stats-grid" id="topCards">
                <!-- Infused by JS -->
                <div class="card"><h3>Loading...</h3></div>
                <div class="card"><h3>Loading...</h3></div>
                <div class="card"><h3>Loading...</h3></div>
            </div>

            <div class="dashboard-grid">
                <!-- Chart -->
                <div class="chart-container">
                    <div style="display:flex; justify-content:space-between; margin-bottom: 20px;">
                        <h3>Bitcoin Price History (7d)</h3>
                        <div style="font-size:0.8rem; color:var(--text-gray);">Updated: just now</div>
                    </div>
                    <canvas id="mainChart"></canvas>
                </div>

                <!-- Live Ticker List -->
                <div class="market-list">
                    <h3>Top Movers</h3>
                    <div id="coinList">
                        <!-- Infused by JS -->
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // 1. Fetch Live Crypto Data (Simulated Real-Time) via Public API
        // using CoinGecko Public API (No key needed for basic usage)
        
        const cardContainer = document.getElementById('topCards');
        const listContainer = document.getElementById('coinList');
        let chartInstance = null;

        async function initDashboard() {
            try {
                // Fetch basic data
                const response = await fetch('https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&order=market_cap_desc&per_page=6&page=1&sparkline=true');
                const data = await response.json();
                
                renderCards(data.slice(0, 4));
                renderList(data);
                renderChart(data[0]); // BTC Chart

            } catch (error) {
                console.error("API Error, using fallback data");
                // Fallback if API fails (Rate limit)
                useFallbackData();
            }
        }

        function renderCards(coins) {
            cardContainer.innerHTML = '';
            coins.forEach(coin => {
                const change = coin.price_change_percentage_24h_in_currency;
                const isUp = change >= 0;
                
                cardContainer.innerHTML += `
                    <div class="card">
                        <div style="display:flex; justify-content:space-between; align-items:center;">
                            <h3>${coin.name}</h3>
                            <img src="${coin.image}" style="width:20px;" loading="lazy" decoding="async">
                        </div>
                        <div class="price">$${coin.current_price.toLocaleString()}</div>
                        <span class="change ${isUp ? 'up' : 'down'}">
                            <i class="fas fa-caret-${isUp ? 'up' : 'down'}"></i> ${Math.abs(change).toFixed(2)}%
                        </span>
                    </div>
                `;
            });
        }

        function renderList(coins) {
            listContainer.innerHTML = '';
            coins.forEach(coin => {
                const isUp = coin.price_change_percentage_24h_in_currency >= 0;
                listContainer.innerHTML += `
                    <div class="coin-row">
                        <div class="coin-info">
                            <img src="${coin.image}" loading="lazy" decoding="async">
                            <div>
                                <div style="font-weight:700; font-size:0.9rem;">${coin.symbol.toUpperCase()}</div>
                                <div style="font-size:0.8rem; color:var(--text-gray);">${coin.name}</div>
                            </div>
                        </div>
                        <div style="text-align:right;">
                            <div style="font-weight:600;">$${coin.current_price.toLocaleString()}</div>
                            <div style="font-size:0.8rem; color:${isUp ? 'var(--success)' : 'var(--danger)'};">
                                ${isUp ? '+' : ''}${coin.price_change_percentage_24h_in_currency.toFixed(2)}%
                            </div>
                        </div>
                    </div>
                `;
            });
        }

        function renderChart(btcData) {
            const ctx = document.getElementById('mainChart').getContext('2d');
            const prices = btcData.sparkline_in_7d.price; // 7 day hourly data
            const labels = Array.from({length: prices.length}, (_, i) => i);

            // Gradient
            const gradient = ctx.createLinearGradient(0, 0, 0, 400);
            gradient.addColorStop(0, 'rgba(13, 138, 188, 0.5)');
            gradient.addColorStop(1, 'rgba(13, 138, 188, 0)');

            chartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'BTC Price',
                        data: prices,
                        borderColor: '#0d8abc',
                        backgroundColor: gradient,
                        borderWidth: 2,
                        fill: true,
                        pointRadius: 0,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    plugins: { legend: { display: false } },
                    scales: { x: { display: false }, y: { display: false } }
                }
            });
        }

        function useFallbackData() {
            // Mock data incase API fails
             alert("Live API Limit reached. Switching to Simulation Mode.");
        }

        initDashboard();

        // Simulate live updates every 5 seconds (jitter price to look alive)
        setInterval(() => {
            const prices = document.querySelectorAll('.price');
            prices.forEach(el => {
                let val = parseFloat(el.innerText.replace('$','').replace(',',''));
                let jitter = (Math.random() - 0.5) * (val * 0.001); // 0.1% move
                val += jitter;
                el.innerText = '$' + val.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2});
                
                // Flash effect
                el.style.color = jitter > 0 ? 'var(--success)' : 'var(--danger)';
                setTimeout(() => el.style.color = 'white', 500);
            });
        }, 3000);

    </script>
<script src="https://unpkg.com/lenis@1.0.45/dist/lenis.min.js"></script>

<script>
    // Smooth scrolling for demos
    const lenis = new Lenis({
      duration: 1.2,
      easing: (t) => Math.min(1, 1.001 - Math.pow(2, -10 * t)),
      direction: 'vertical',
      gestureDirection: 'vertical',
      smooth: true,
      mouseMultiplier: 0.8,
      smoothTouch: false,
      touchMultiplier: 2,
    });

    function raf(time) {
      lenis.raf(time);
      requestAnimationFrame(raf);
    }

    requestAnimationFrame(raf);
</script>

</body>
</html>